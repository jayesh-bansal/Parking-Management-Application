{% extends "base.html" %}

{% block title %}View Parking Spots - Vehicle Parking App{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-car"></i> {{ lot.prime_location_name }}</h2>
        <p class="text-muted mb-0">{{ lot.address }} - {{ lot.pin_code }}</p>
        <p class="text-muted">Price: ${{ "%.2f"|format(lot.price) }}/hour</p>
    </div>
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h4>{{ spots|length }}</h4>
                <p class="mb-0">Total Spots</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h4>{{ spots|selectattr("status", "equalto", "A")|list|length }}</h4>
                <p class="mb-0">Available</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body text-center">
                <h4>{{ spots|selectattr("status", "equalto", "O")|list|length }}</h4>
                <p class="mb-0">Occupied</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-dark">
            <div class="card-body text-center">
                <h4>{{ ((spots|selectattr("status", "equalto", "A")|list|length / spots|length) * 100)|round|int }}%</h4>
                <p class="mb-0">Availability</p>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Parking Spots Layout</h5>
    </div>
    <div class="card-body">
        <div class="mb-3">
            <span class="parking-spot spot-available me-2">A</span> Available
            <span class="parking-spot spot-occupied ms-4 me-2">O</span> Occupied
        </div>
        
        <div class="parking-layout">
            {% for spot in spots %}
                <div class="parking-spot {% if spot.status == 'A' %}spot-available{% else %}spot-occupied{% endif %}" 
                     title="Spot #{{ spot.spot_number }} - {% if spot.status == 'A' %}Available{% else %}Occupied{% endif %}">
                    {{ spot.spot_number }}
                </div>
                {% if loop.index % 10 == 0 %}
                    <br>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

{% if spot_reservations %}
<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0">Current Reservations</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Spot #</th>
                        <th>User</th>
                        <th>Parking Time</th>
                        <th>Duration</th>
                    </tr>
                </thead>
                <tbody>
                    {% for spot_id, reservation in spot_reservations.items() %}
                    <tr>
                        <td>{{ reservation.parking_spot.spot_number }}</td>
                        <td>{{ reservation.user.username }}</td>
                        <td>{{ reservation.parking_timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            {% set duration = (moment.utcnow() - reservation.parking_timestamp).total_seconds() / 3600 %}
                            {{ "%.1f"|format(duration) }} hours
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
